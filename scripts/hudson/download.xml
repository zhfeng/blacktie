<project name="blacktie-dependencies"> 
   <target name="download"> 
       <get src="http://172.17.131.2/userContent/blacktie/instantclient-basiclite-win32-11.2.0.1.0.zip" dest="./instantclient-basiclite-win32-11.2.0.1.0.zip" verbose="true" usetimestamp="true" skipexisting="true"/> 
       <get src="http://172.17.131.2/userContent/blacktie/instantclient-sdk-win32-11.2.0.1.0.zip" dest="./instantclient-sdk-win32-11.2.0.1.0.zip" verbose="true" usetimestamp="true" skipexisting="true"/> 
       <get src="http://172.17.131.2/userContent/blacktie/tnsnames.ora" dest="./tnsnames.ora" verbose="true" usetimestamp="true" skipexisting="true"/> 
       <delete dir="instantclient_11_2"/> 
       <unzip src="./instantclient-basiclite-win32-11.2.0.1.0.zip" dest="."/> 
       <unzip src="./instantclient-sdk-win32-11.2.0.1.0.zip" dest="."/> 
       <mkdir dir="./instantclient_11_2/network/admin"/> 
       <copy file="./tnsnames.ora" tofile="./instantclient_11_2/network/admin/tnsnames.ora"/> 
       <move tofile="./instantclient_11_2/OCI" file="./instantclient_11_2/sdk"/> 
       <move tofile="./instantclient_11_2/OCI/lib/MSVC2" file="./instantclient_11_2/OCI/lib/msvc"/> 
       <move tofile="./instantclient_11_2/OCI/lib/MSVC" file="./instantclient_11_2/OCI/lib/MSVC2"/> 
       <mkdir dir="./instantclient_11_2/bin"/> 
       <move todir="./instantclient_11_2/bin"> 
           <fileset dir="./instantclient_11_2/"> 
               <include name="*.dll"/> 
           </fileset> 
       </move> 
       <get src="http://172.17.131.2/userContent/blacktie/jboss-as-7.1.0.Final.zip" dest="./jboss-as-7.1.0.Final.zip" verbose="true" usetimestamp="true" skipexisting="true"/> 
<!--       <get src="http://172.17.131.2/userContent/blacktie/jbossesb-4.9.zip" dest="./jbossesb-4.9.zip" verbose="true" usetimestamp="true" skipexisting="true"/>  -->
       <delete dir="jboss-as-7.1.0.Final"/> 
       <unzip src="./jboss-as-7.1.0.Final" dest="."/> 
<!--       <delete dir="jbossesb-4.9"/> 
       <unzip src="./jbossesb-4.9.zip" dest="."/> -->
   </target> 
   <target name="replaceJBoss"> 
       <replaceregexp byline="true" file="jboss-5.1.0.GA/bin/run.conf" match="Xms128m" replace="Xms768"  /> 
       <replaceregexp byline="true" file="jboss-5.1.0.GA/bin/run.conf" match="Xmx512m" replace="Xmx768"  /> 
       <replaceregexp byline="true" file="jboss-5.1.0.GA/server/all-with-hornetq/conf/jbossts-properties.xml" match="CONFIGURATION_FILE" replace="NAME_SERVICE"  /> 
       <replaceregexp byline="true" file="jboss-5.1.0.GA/server/all-with-hornetq/conf/jacorb.properties" match="localhost" replace="${JBOSSAS_IP_ADDR}"  /> 
       <replaceregexp byline="true" file="jboss-5.1.0.GA/server/all-with-hornetq/conf/jboss-log4j.xml" match="&lt;root&gt;" replace="&lt;category name=&quot;org.jboss.narayana.blacktie&quot;&gt;&lt;priority value=&quot;ALL&quot; /&gt;&lt;/category&gt;&lt;category name=&quot;org.codehaus.stomp&quot;&gt;&lt;priority value=&quot;ALL&quot; /&gt;&lt;/category&gt;&lt;root&gt;"  /> 
   </target> 
<target name="configureHornetQ"> 
       <replaceregexp byline="true" file="jboss-5.1.0.GA/server/all-with-hornetq/deploy/hornetq.sar/hornetq-configuration.xml" match="&lt;/security-settings&gt;" replace="&lt;security-setting match=&quot;jms.queue.BTR_BTDomainAdmin&quot;&gt;&#10;         &lt;permission type=&quot;send&quot; roles=&quot;blacktie,guest&quot;/&gt;&#10;         &lt;permission type=&quot;consume&quot; roles=&quot;blacktie,guest&quot;/&gt;&#10;      &lt;/security-setting&gt;&#10;      &lt;security-setting match=&quot;jms.queue.BTR_BTStompAdmin&quot;&gt;&#10;         &lt;permission type=&quot;send&quot; roles=&quot;blacktie,guest&quot;/&gt;&#10;         &lt;permission type=&quot;consume&quot; roles=&quot;blacktie,guest&quot;/&gt;&#10;      &lt;/security-setting&gt;&lt;/security-settings&gt;"  /> 
       <replaceregexp byline="true" file="jboss-5.1.0.GA/server/all-with-hornetq/deploy/hornetq.sar/hornetq-jms.xml" match="&lt;connection-factory name=&quot;InVMConnectionFactory&quot;&gt;" replace="&lt;connection-factory name=&quot;InVMConnectionFactory&quot;&gt;&#10;         &lt;consumer-window-size&gt;0&lt;/consumer-window-size&gt;"  /> 
       <replaceregexp byline="true" file="jboss-5.1.0.GA/server/all-with-hornetq/deploy/hornetq.sar/hornetq-jms.xml" match="&lt;connection-factory name=&quot;InVMConnectionFactory&quot;&gt;" replace="&lt;connection-factory name=&quot;InVMConnectionFactory&quot;&gt;&#10;      &lt;connection-ttl&gt;-1&lt;/connection-ttl&gt;&#10;      &lt;client-failure-check-period&gt;86400000&lt;/client-failure-check-period&gt;" /> 
       <replaceregexp byline="true" file="jboss-5.1.0.GA/server/all-with-hornetq/deploy/hornetq-ra.rar/META-INF/ra.xml" match="&lt;resourceadapter-class&gt;org.hornetq.ra.HornetQResourceAdapter&lt;/resourceadapter-class&gt;" replace="&lt;resourceadapter-class&gt;org.hornetq.ra.HornetQResourceAdapter&lt;/resourceadapter-class&gt;&#10;      &lt;config-property&gt;&#10;        &lt;description&gt;The connection TTL&lt;/description&gt;&#10;        &lt;config-property-name&gt;ConnectionTTL&lt;/config-property-name&gt;&#10;        &lt;config-property-type&gt;java.lang.Long&lt;/config-property-type&gt;&#10;        &lt;config-property-value&gt;-1&lt;/config-property-value&gt;&#10;      &lt;/config-property&gt;&#10;      &lt;config-property&gt;&#10;        &lt;description&gt;The client failure check period&lt;/description&gt;&#10;        &lt;config-property-name&gt;ClientFailureCheckPeriod&lt;/config-property-name&gt;&#10;        &lt;config-property-type&gt;java.lang.Long&lt;/config-property-type&gt;&#10;        &lt;config-property-value&gt;86400000&lt;/config-property-value&gt;&#10;      &lt;/config-property&gt;" /> 
</target> 
<target name="initializeBlackTieQuickstartSecurity"> 
       <replaceregexp byline="true" file="jboss-5.1.0.GA/server/all-with-hornetq/deploy/hornetq.sar/hornetq-configuration.xml" match="&lt;/security-settings&gt;" replace="v      &lt;security-setting match=&quot;jms.queue.BTR_SECURE&quot;&gt;&#10;         &lt;permission type=&quot;send&quot; roles=&quot;blacktie&quot;/&gt;&#10;         &lt;permission type=&quot;consume&quot; roles=&quot;blacktie&quot;/&gt;&#10;      &lt;/security-setting&gt;&#10;&lt;/security-settings&gt;"  /> 
</target> 
   <target name="configureESB"> 
       <replaceregexp byline="true" file="jbossesb-4.9/install/deployment.properties" match="/jbossesb-server-4.5.GA" replace="${WORKSPACE}/jboss-5.1.0.GA" /> 
       <replaceregexp byline="true" file="jbossesb-4.9/install/deployment.properties" match="=default" replace="=all-with-hornetq" /> 
       <replaceregexp byline="true" file="jbossesb-4.9/install/deployment.properties" match="^(org.jboss.esb.tomcat.home)" replace="#\1" /> 
       <replaceregexp byline="true" file="jbossesb-4.9/install/build.xml" match="(/hornetq)" replace="\1.sar" /> 
</target> 
</project> 
